# 아이템 67. 최적화는 신중히 하라

최적화는 섣불리 진행하면 좋은 결과보다 해로운 결과로 이어지기 쉽다.

따라서, 프로그램이 유지보수가 쉽도록 우선 좋은 아키텍처로 설계한 이후에 최적화를 고려해야 하는 게 좋다.

## 최적화 방법

그렇다면 어떻게 해야 최적화를 잘 할수 있을까?

1. **성능을 제한하는 설계를 피하라.**

구현상의 문제가 아닌 아키텍처 결함이 성능을 제한하는 상황이라면, 완성된 기본 틀을 변경해야 하기 때문에 유지보수나 개선하기 어려운 시스템이 만들어진다. <br>
따라서, 성능을 염두해두고 설계하도록 하자.

2. **API 설계 시 성능에 주는 영향을 고려하라.**

다음과 같은 설계는 성능에 악영향을 줄 수 있다.

* public 타입을 가변으로 만들어 내부 데이터를 변경할 수 있게 만드는 것은, 불필요한 방어적 복사를 유발하는 경우
* 컴포지션으로 해결할 수 있음에도 상속 방식으로 설계해, 상위 클래스의 성능 제약을 같이 가져오는 경우
* 인터페이스가 아닌 구현 타입을 사용함으로 다른 구현체 사용을 어렵게 하는 경우

3. **성능을 위해 API를 왜곡하지 마라.** 

API를 왜곡하도록 만든 그 성능 문제는 소프트웨어의 다음 버전에서 해결되어 사라질 수도 있다.

하지만 한 번 API를 왜곡하면, 계속해서 그 왜곡한 버전을 지원해야해 고통이 뒤따를 것이다.

4. **각각의 최적화 시도 전후로 성능을 측정하라.**

시도한 최적화 기법이 성능을 높이지 못하거나 오히려 나쁘게 할 수도 있다. <br>
프로그램 어디에서 시간이 잡아먹히는지 제대로 파악하지 못했기 때문이다.<br>
(자바의 정교하지 않은 성능 모델이 한 몫 하기도 한다.)

따라서 최적화 시도 전후의 성능 측정은 최적화에 도움이 된다.

이를 위해 프로파일링 도구를 적극 활용하는 것도 좋다.

프로파일링 도구는 개별 메서드의 소비 시간과 호출 횟수 같은 런타임 정보를 제공하여, <br>
최적화 노력을 어디에 집중해야 할지 찾는 데 도움을 준다.

JMH[[설명 블로그](https://ysjee141.github.io/blog/quality/java-benchmark/)]도 알아두면 좋은 도구다. 
프로파일링 도구는 아니지만 자바 코드의 상세한 성능을 알기 쉽게 보여주는 마이크로 벤치마킹 프레임워크다.

